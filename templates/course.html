<!-- course.html -->
{% extends "base.html" %}
{% load staticfiles %}
{% load guardian_tags %}


{% block page_crumb %}{% endblock page_crumb %}

{% block local_nav %}
    {% if is_manager %}
    <li>
        <a class="static nav-text" href="{% url 'create_user' course.slug %}">
            <i class="fa fa-user-plus text-primary"></i>
        </a>
    </li>
    {% endif %}
{% endblock local_nav %}

{% block page_header %}

<div class="col-md-12 text-center">
    {% if request.user.ggvuser.language_pref == 'spanish' %}
        <h2><i class="fa fa-home"></i> Página del CurrÍculo de Estudios GGV</h2>
    {% else %}
        <h2><i class="fa fa-home"></i> GGV Curriculum Page</h2>     
    {% endif %}
    <p class="lead">{{ course }}</p>    
</div>
<div class="col-md-11"></div>
<div class="col-md-1">
        <div class="" id="user_prefs" 
            data-last_act="{{last_activity}}" 
            data-placement="left" 
            data-toggle="tooltip" 
            data-trigger="manual" 
            data-html="true"''
            title="<p>Continue with last activity?</p><p>{{last_activity}}</p><p> <button id='act_cancel' class='btn btn-sm'>No Thanks!</button></p>" 
            data-template='<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner" style="background-color: #fff; color: #000; border: 1px #888 solid"></div></div>'>
        </div>
</div>
{% endblock page_header %}

{% block content %}
    {% if site_message and site_message.show %}
    <div class="col-md-8 col-md-offset-2 text-center well" style="background-color: #fafafa; border: none">
            {{ site_message.message|safe }}
    </div>
    {% endif %}

    {% if is_instructor or is_manager %}
    <div class="col-md-8 col-md-offset-2 text-center">
        
        {% if not site_message %} 
            <a href="{% url 'add_course_msg' object.slug %}" class="btn btn-md"><i class="fa fa-plus"></i><i class="fa fa-comments-o"></i> Add a <em>Message Panel</em></a>
        {% elif not site_message.show %}
            <a href="{% url 'edit_course_msg' object.slug site_message.id %}"><i class="fa fa-comments-o"></i> Unhide <em>Message Panel</em></a> 
        {% else %}
            <a href="{% url 'edit_course_msg' course.slug site_message.id %}" class="btn btn-md"><i class="fa fa-gear"></i> Edit or Hide <em>Course Message Panel</em></a>
        {% endif %}
     
    </div>
    {% endif %}
    
    <div class="row" style="padding: 10px"><h1></h1></div>

<!-- LANGUAGE BTN -->
    <div class="row" style="padding: 10px">
        <div class="col-md-12 text-center">
        {% if english_lessons and spanish_lessons %}
            <a class="nav-btn btn-group btn-toggle">
                {% if user.ggvuser.language_pref == 'spanish' %}
                    <button class="btn btn-xs btn-default">English</button>
                    <button class="btn btn-xs btn-success active">Español</button>
                {% else %}
                    <button class="btn btn-xs btn-success active">English</button>
                    <button class="btn btn-xs btn-default">Español</button>
                {% endif %}
            </a>
        {% endif %}
        </div>
    </div>

    <div class="row" style="padding: 10px"><h1></h1></div>

<!-- LESSON BTNS -->

    <div class="row icon eng {% if user.ggvuser.language_pref == 'spanish' %}collapse{% endif %}">
        {% for i, j in english_lessons %}
        	<div class="col-md-3 icon-{{ i.lesson.subject }}">
        		<a class="static" href="{{ i.get_absolute_url }}">
        			<i class="fa fa-{{ i.lesson.icon_class }} fa-5x"></i>
                    <p class="icon-title">{{ i.lesson.title }}</p>
        		</a>
                {% if i.lesson.subject != 'default' %}
                <div class="well text-left">
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#{{i.lesson.subject}}-ed-plan"><img src="{% static 'img/ed-plan.png' %}" height="32px"> Educational Plan</a></p>
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#{{i.lesson.subject}}-study-guide"><img src="{% static 'img/study-guide.png' %}" height="32px"> Study Guide</a></p>
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#steps-to-completion"><img src="{% static 'img/steps.png' %}" height="32px"> Steps to Completion</a></p>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="steps-to-completion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Steps To Completion (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                            {{ j.2.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal fade" id="{{i.lesson.subject}}-ed-plan" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">{{ i.lesson.title }} Educational Plan (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                        {{ j.0.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal fade" id="{{i.lesson.subject}}-study-guide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">{{ i.lesson.title }} Study Guide (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                        {{ j.1.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
        	</div>
        {% endfor %}
    </div>

    <div class="row icon span {% if user.ggvuser.language_pref != 'spanish' %}collapse{% endif %}">

        {% for i, j in spanish_lessons %}
            <div class="col-md-3 icon-{{ i.lesson.subject }}">
                <a class="static" href="{{ i.get_absolute_url }}">
                    <i class="fa fa-{{ i.lesson.icon_class }} fa-5x"></i>
                    <p class="icon-title">{{ i.lesson.title }}</p>
                </a>
                {% if i.lesson.subject != 'default' %}
                <div class="well text-left">
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#{{i.lesson.subject}}-ed-plan-span"><img src="{% static 'img/ed-plan.png' %}" height="32px"> Plan Educativo</a></p>
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#{{i.lesson.subject}}-study-guide-span"><img src="{% static 'img/study-guide.png' %}" height="32px"> Guía de Estudio</a></p>
                    <p><a href="" class="static btn-link" data-toggle="modal" data-target="#steps-to-completion-span"><img src="{% static 'img/steps.png' %}" height="32px"> Pasos Para Completar</a></p>
                </div>

                <!-- Modal -->
                <div class="modal fade" id="steps-to-completion-span" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Pasos Para Completar (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                        {{ j.2.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal fade" id="{{i.lesson.subject}}-ed-plan-span" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">{{ i.lesson.title }} Plan Educativo (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                        {{ j.0.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal fade" id="{{i.lesson.subject}}-study-guide-span" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">{{ i.lesson.title }} Guía de Estudio (scroll below to view document)</h4>
                      </div>
                      <div class="modal-body">
                        {{ j.1.content|safe }}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i></button>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

{% if is_manager or is_instructor%}

    {% comment %}


    <div class="row">
        <h4>Notifications:</h4>
        <div class="col-md-12 well">

            {% for i in notifications %}
                {% if i.logdata %}
                <div>{{ i.logdata.user }} ==> {{ i.logdata.action }} {{ i.logdata.message|safe }}</div>
                {% else %}
                <div>{{i.context }} {{ i.event }} </div>
                {% endif %}

            {% endfor %}


        </div>
    </div>
    {% endcomment %}
{% endif %}

{% comment %}
    <div class="row">
        <div class="col-xs-12">
            <h4>Active Students ({{ students|length}}) </h4>
        </div>
        <div id="sorter" class="col-xs-12">
            <div class="col-xs-2">
                <button class="btn btn-block btn-sm btn-primary" data-sort-by="firstname" data-order="asc"> <i class="fa fa-sort"></i> first</button>
            </div>
            <div class="col-xs-2">
                <button class="btn btn-block btn-sm" data-sort-by="lastname" data-order="asc"> <i class="fa fa-sort"></i> last</button>
            </div>

            <div class="col-xs-2">
                <button class="btn btn-block btn-sm" data-sort-by="login" data-order="asc"> <i class="fa fa-sort"></i> last login</button>
            </div>

            <div class="col-xs-3">
                <button class="btn btn-block btn-sm" data-sort-by="username" data-order="asc"> <i class="fa fa-sort"></i> username</button>
            </div>
            <div class="col-xs-3">
                <button class="btn btn-sm" data-sort-by="original-order"><i class="fa fa-refresh"></i></button>
            </div>
        </div>

        <div id="container_0" class="col-xs-12">
            {% for i in students %}
                <div class="col-xs-12 item hoverpad" data-login="{{ i.last_login|date:'U' }}" data-recent="{{ i.last_login|date:'U' }}">
                    <a href="{% url 'user_progress' course.slug i.id %}" class="static">
                    <div class="col-xs-2 firstname">{{ i.first_name }}</div>
                    <div class="col-xs-2 lastname">{{ i.last_name }}</div>
                    <div class="col-xs-2 login">{{ i.last_login|date:"M d, g:i A" }}</div>
                    <div class="col-xs-3 username"><span class="small">{{ i.username }}</span></div>
                    <div class="col-xs-3"></div>
                    </a>
                </div>
            {% empty %}
                <div class="col-xs-12">No students are assigned to this course.</div>
            {% endfor %}
        </div>

    </div>
{% endif %}

{% if user.is_staff %}

    <div class="row">
        <div class="col-xs-12 ">
            <h4>Instructors ({{ instructors|length}}) </h4>
            <div class="col-xs-2"><button class="btn btn-sm btn-block">first</button></div>
            <div class="col-xs-2"><button class="btn btn-sm btn-block">last</button></div>
            <div class="col-xs-2"><button class="btn btn-sm btn-block">last login</button></div>
            <div class="col-xs-3"><button class="btn btn-sm btn-block">username</button></div>
            <div class="col-xs-3"></div>
        </div>
        <div class="col-xs-12">
            {% for i in instructors %}
            <div class="col-xs-12 item hoverpad" data-login="{{ i.last_login|date:'U' }}" data-recent="{{ i.last_login|date:'U' }}">
                <a href="{% url 'manage_user' course.slug i.id %}" class="static">
                    <div class="col-xs-2 firstname">{{ i.first_name }}</div>
                    <div class="col-xs-2 lastname">{{ i.last_name }}</div>
                    <div class="col-xs-2 login">{{ i.last_login|date:"M d, g:i A" }}</div>
                    <div class="col-xs-3 username"><span class="small">{{ i.username }}</span></div>
                    <div class="col-xs-3"></div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

{% else %}
    <div class="row">
        <div class="col-xs-12">
        {% for i in instructors %}
            <span><em>{{ i.first_name }} {{ i.last_name }}{% if i == request.user %}<small> (this is you) </small> {% endif %}, </em></span>
        {% empty %}
            <p>No instructors are assigned to this lesson.</p>
        {% endfor %}
        </div>
    </div>
{% endif %}
{% endcomment %}

{% endblock content %}



{% block local_js %}
    <script src="{% static 'js/isotope.pkgd.min.js'%}"></script>

    <script type="text/javascript">
        jQuery(function($) {

            $('.btn-toggle').click(function() {
                $(this).find('.btn').toggleClass('active');
                $(this).find('.btn').toggleClass('btn-success');
                $(this).find('.btn').toggleClass('btn-default');
                $('.eng').toggleClass('collapse')
                $('.span').toggleClass('collapse')
            });

            var $container = $('#container_0').isotope({
                getSortData: {
                    login: '[data-login] parseInt',
                    recent_timestamp: '[data-recent] parseInt',
                    firstname: '.firstname',
                    lastname: '.lastname',
                    username: '.username'
                },

            });

            // sort items on button click
            $('#sorter').on( 'click', 'button', function() {
                var sortByValue = $(this).attr('data-sort-by');
                var order = "";
                if ($(this).attr("data-order")==="asc") {
                    order = true;
                    $(this).attr("data-order", "");

                } else {
                    order = false;
                    $(this).attr("data-order", "asc");
                }
                $('.btn-primary').removeClass('btn-primary');
                $(this).addClass("btn-primary");

                $container.isotope({
                    sortBy: sortByValue,
                    sortAscending: order
                });
            });
            $('[data-toggle="tooltip"]').tooltip();

            $(document).ready(function() { 
                if ($("#user_prefs").data('last_act')) {
                    $("#user_prefs").tooltip('show')
                    // $("#prev_act").hide();   
                }
                $("#act_cancel").on("click", function() {
                    $("#user_prefs").tooltip('hide')
                });
                
            });
        });
    </script>

{% endblock local_js %}


