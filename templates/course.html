<!-- course.html -->
{% extends "base.html" %}
{% load staticfiles %}
{% load guardian_tags %}


{% block page_crumb %}
    <li><a href="" class="">{{ object }} Home</a></li>
{% endblock page_crumb %}

{% block local_nav %}
    {% if is_instructor or is_manager %}
        <li><a href="{% url 'manage_course' course.slug %}"><button class="btn btn-xs btn-success">Roster Manager</button></a></li>
    {% endif %}
    {% if is_manager %}<li><a href="{% url 'create_user' course.slug %}"><button class="btn btn-success btn-xs"><i class="fa fa-plus"></i> Add User </button> </a></li>{% endif %}
{% endblock local_nav %}

{% block page_header %}
<div class="col-md-12 center-block">
    <h1></h1>
    <div class="btn-group btn-toggle">
    {% if eng_lessons and span_lessons %}
        {% if user.ggvuser.language_pref == 'spanish' %}
            <button class="btn btn-md btn-default">English</button>
            <button class="btn btn-md btn-success active">Español</button>
        {% else %}
            <button class="btn btn-md btn-success active">English</button>
            <button class="btn btn-md btn-default">Español</button>
        {% endif %}
    {% endif %}
    </div>
    <h1></h1>
</div>
{% endblock page_header %}

{% block content %}
    <div class="row icon eng {% if user.ggvuser.language_pref == 'spanish' %}collapse{% endif %}">
        {% for i in eng_lessons %}
        	<div class="col-md-3 icon-{{ i.lesson.subject }}">
        		<a class="static" href="{{ i.get_absolute_url }}">
        			<i class="fa fa-{{ i.lesson.icon_class }} fa-5x"></i>
            <p class="icon-title">{{ i.lesson.title }}</p>
        		</a>
        	</div>
        {% endfor %}
    </div>

    <div class="row icon span {% if user.ggvuser.language_pref != 'spanish' %}collapse{% endif %}">
        {% for i in span_lessons %}
        <div class="col-md-3 icon-{{ i.lesson.subject }}">
          <a class="static" href="{{ i.get_absolute_url }}">
            <i class="fa fa-{{ i.lesson.icon_class }} fa-5x"></i>
            <p class="icon-title">{{ i.lesson.title }}</p>
          </a>
        </div>
        {% endfor %}
    </div>

{% if is_instructor or is_manager %}
    {% comment %}
    <div class="row">
        <h4>Notifications:</h4>
        <div class="col-md-12 well">

            {% for i in notifications %}
                <div></div>
            {% endfor %}


        </div>
    </div>
    {% endcomment %}

    <div class="row">
        <div id="sorter" class="col-xs-12">
            <h4>Roster: ({{ students|length}} active students) </h4>

            <div class="col-xs-1">
                <button class="btn btn-block btn-sm btn-primary" data-sort-by="firstname" data-order="asc"> <i class="fa fa-sort"></i> first</button>
            </div>
            <div class="col-xs-1">
                <button class="btn btn-block btn-sm" data-sort-by="lastname" data-order="asc"> <i class="fa fa-sort"></i> last</button>
            </div>

            <div class="col-xs-2">
                <button class="btn btn-block btn-sm" data-sort-by="login" data-order="asc"> <i class="fa fa-sort"></i> last login</button>
            </div>

            <div class="col-xs-4">
                <button class="btn btn-block btn-sm" data-sort-by="recent_timestamp" data-order="asc"><i class="fa fa-sort"></i> last activity</button>
            </div>
            <div class="col-xs-2">
                <button class="btn btn-block btn-sm" data-sort-by="username" data-order="asc"> <i class="fa fa-sort"></i> username</button>
            </div>
            <div class="col-xs-2">
                <button class="btn btn-sm" data-sort-by="original-order"><i class="fa fa-refresh"></i></button>
            </div>
        </div>

        <div id="container_0" class="col-xs-12">
        {% for i in students %}

            <div class="col-xs-12 item hoverpad" data-login="{{ i.0.last_login|date:'U' }}" data-recent="{{ i.1.recent_time|date:'U' }}">

                <a href="{% url 'user_progress' course.slug i.0.id %}" class="static">
                <div class="col-xs-1 firstname">{{ i.0.first_name }}</div>
                <div class="col-xs-1 lastname">{{ i.0.last_name }}</div>
                <div class="col-xs-2 login">{{ i.0.last_login|date:"M d, g:i A" }}</div>
                <div class="col-xs-4 recent">{{ i.1.recent_time|date:"M d, g:i A" }} <strong>{{ i.1.recent_act }}</strong></div>
                <div class="col-xs-2 username"><span class="small">{{ i.0.username }}</span></div>
                <div class="col-xs-2"></div>
                </a>

            </div>

        {% empty %}
            <div class="col-xs-12">No students are assigned to this course.</div>
        {% endfor %}
        </div>
    </div>
{% endif %}

{% if user.is_staff %}
    <div class="row">
        <div class="col-xs-12">
            <h4>Instructors: ({{ instructors|length}}) </h4>
            <div class="col-xs-1"><strong>first</strong></div>
            <div class="col-xs-1"><strong>last</strong></div>
            <div class="col-xs-2"><strong>last login</strong></div>
            <div class="col-xs-4"><strong>last activity</strong></div>
            <div class="col-xs-3"><strong>username</strong></div>
            <div class="col-xs-1"></div>
        </div>

        {% for i in instructors %}
        <div class="col-xs-12 item hoverpad" data-login="{{ i.0.last_login|date:'U' }}" data-recent="{{ i.1.recent_time|date:'U' }}">
            <a href="{% url 'manage_user' course.slug i.0.id %}" class="static">
                <div class="col-xs-1 firstname">{{ i.0.first_name }}</div>
                <div class="col-xs-1 lastname">{{ i.0.last_name }}</div>
                <div class="col-xs-2 login">{{ i.0.last_login|date:"M d, g:i A" }}</div>
                <div class="col-xs-4 recent">{{ i.1.recent_time|date:"M d, g:i A" }} <strong>{{ i.1.recent_act }}</strong></div>
                <div class="col-xs-3 username"><span class="small">{{ i.0.username }}</span></div>
                <div class="col-xs-1"></div>
            </a>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="row">
        <div class="col-xs-12">
        {% for i in instructors %}
            <span><em>{{ i.first_name }} {{ i.last_name }}{% if i == request.user %}<small> (this is you) </small> {% endif %}, </em></span>
        {% empty %}
            <p>No instructors are assigned to this lesson.</p>
        {% endfor %}
        </div>
    </div>
{% endif %}

{% endblock content %}



{% block local_js %}
    <script src="{% static 'js/isotope.pkgd.min.js'%}"></script>

    <script type="text/javascript">
        jQuery(function($) {

            $('.btn-toggle').click(function() {
                $(this).find('.btn').toggleClass('active');
                $(this).find('.btn').toggleClass('btn-success');
                $(this).find('.btn').toggleClass('btn-default');
                $('.eng').toggleClass('collapse')
                $('.span').toggleClass('collapse')
            });

            var $container = $('#container_0').isotope({
                getSortData: {
                    login: '[data-login] parseInt',
                    recent_timestamp: '[data-recent] parseInt',
                    firstname: '.firstname',
                    lastname: '.lastname',
                    username: '.username'
                },

            });

            // sort items on button click
            $('#sorter').on( 'click', 'button', function() {
                var sortByValue = $(this).attr('data-sort-by');
                var order = "";
                if ($(this).attr("data-order")==="asc") {
                    order = true;
                    $(this).attr("data-order", "");

                } else {
                    order = false;
                    $(this).attr("data-order", "asc");
                }
                $('.btn-primary').removeClass('btn-primary');
                $(this).addClass("btn-primary");

                $container.isotope({
                    sortBy: sortByValue,
                    sortAscending: order
                });
            });

            $(document).ready(function() { });
        });
    </script>

{% endblock local_js %}


