<!-- question_embed.html -->
{% extends "base.html" %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block page_crumb %}
    <li><a href="{{ course.get_absolute_url }}">{{ course }} <i class="fa fa-caret-right"></i></a></li>
    <li><a href="{% url 'lesson' course.slug worksheet.lesson.id %}">{{ worksheet.lesson }} <i class="fa fa-caret-right"></i></a></li>
    <li><a>{{ worksheet }}</a></li>
    <li>
        <a class="dropdown" id="dLabel" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" role="" aria-expanded="false">
        Progress
        <span class="caret"></span>
        </a>
        <div class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            {% if edit_url %}<a href="{% url 'worksheet_report' course.slug worksheet.id %}" class="btn btn-xs btn-success">Full Report</a>{% endif %}
            {% if user_completed %}<a href="{% url 'worksheet_user_report' course.slug worksheet.id %}"  class="btn btn-xs btn-success">Report</a> {% endif %}
            <h5 class=""></h5>
        {% for k, v in question_list.items %}
            <div class="pull-left" style="padding: 5px; background-color: {{ v }}">

                <a href="{% url 'question_response' course.slug worksheet.id forloop.counter %}">
                    {% if forloop.counter == question_position  %}
                        <span class="badge">{{ forloop.counter }}</span>
                    {% else %}
                        <span>{{ forloop.counter }}</span>
                    {% endif %}
                </a>

            </div>
        {% endfor %}
        </div>
    </li>
{% endblock page_crumb %}

{% block content %}
    <div class="col-md-12">
        <div class="row " style="padding-top: 10px">

            <form  id="flag_form" action="" method="post">{% csrf_token %}
                {{ bookmarkform|crispy }}
            </form>

            <div class="col-md-4 ">
                <div class="lead">
                    {{ question_position }}/{{ question_list|length }}.
                    {% if edit_url %}<a href="{{ edit_url }}" class="btn btn-xs btn-success">edit</a>{% endif %}
                    <i class="fa fa-flag flagger {% if bookmark %}bkset{% endif %}" data-target="{{ bookmark.id }}" data-form="#flag_form"></i>

                    <!-- <button class="btn btn-xs btn-primary" data-toggle="popover" data-placement="right" data-content="help">progress</button> -->


                </div>
                <div class="lead">{{ question | safe }} </div>
                <form id="response_form" action="" method="post" >{% csrf_token %}
                    {% for hidden in form.hidden_fields %} {{ hidden }} {% endfor %}

                    <p class="label label-danger">{% for e in form.response.errors  %}An answer is required.{% endfor %}</p>
                    <p></p>

                    {% for field in form.response %}
                    <p>
                        {% if not field.choice_label %}

                            <label for="{{ field.id_for_label }}">{{ field }}</label>

                        {% else %}

                            <label for="{{ field.id_for_label }}">
                                {{ field.tag }} {{ field.choice_label | safe }}
                            </label>

                        {% endif %}
                    </p>
                    {% endfor %}
                    <p></p>
                    <p>
                        {%if user_completed and previous_position %}
                            <a href="{% url 'question_response' course.slug worksheet.id previous_position %}" class="btn">Previous</a>
                        {% endif %}

                        <input id="chk_response_btn" type="submit" value="Submit Answer" class="btn btn-default">

                        {% if user_completed and next_position  %}
                            <a href="{% url 'question_response' course.slug worksheet.id next_position %}" class="btn">Next</a>
                        {% endif %}
                    </p>
                </form>
            </div>
            {%if question.display_image %}
            <div class="col-md-8">
                    <div><img class="fit" src="{{ question.display_image.url }}"></div>
            </div>
            {% endif %}
            {%if question.display_pdf %}
            <div class="col-md-8">
                <object width="100%" height="600px" data="{{ question.display_pdf.url }}"></object>
            </div>

            {% endif %}

            {% if worksheet.display_pdf %}
            <div class="col-md-8">
                <object width="100%" height="600px" data="{{ worksheet.display_pdf.url }}"></object>
            </div>
            {% endif %}

        </div>
        <div class="row">
            <div class="col-md-12">
                <legend>Messages
                <a data-toggle="collapse" href="#add_note_panel" aria-controls="add_note_panel"><small>+</small></a>
                </legend>


                    <div id="add_note_panel" class="panel-collapse collapse">
                            <form id="noteform" action="" method="post">{% csrf_token %}
                                {{ noteform|crispy }}
                                <p><input id="note_submit_btn" type="submit" class="btn btn-default" value="Add Note"/></p>
                            </form>
                    </div>


                <dl id="notes">
                {% for i in note_list  %}
                    <dt><small>{{ i.creator }}</small><small style="float: right">{{ i.modified|date:"M j Y" }}</small></dt>
                    <dd class="well">{{ i.text }}</dd>
                {% endfor %}
                </dl>


            </div>

        </div>
    </div>
{% endblock content %}

{% block local_js %}
    <script src="//tinymce.cachefly.net/4.1/tinymce.min.js"></script>
    <script>tinymce.init({selector:'textarea.editor'});</script>
    <script src="{% static 'js/questions.js'%}"></script>

    <script type="text/javascript" language="JavaScript">
        function set_body_height() {
            var wh = $(window).height();
            $('body').attr('style', 'height:' + wh + 'px;');
        }
        $(document).ready(function() {
            set_body_height();
            $(window).bind('resize', function() { set_body_height(); });
        });
    </script>

{% endblock local_js %}
